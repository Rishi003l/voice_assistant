<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Cyberspace AI Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Base Cyberpunk Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #E0F2F1; /* Light text for contrast */
            overflow-x: hidden; /* Prevent horizontal scroll */
            position: relative;
            min-height: 100vh;
        }

        /* Neon Teal Color Definition */
        .text-neon-teal { color: #14B8A6; }
        .bg-neon-teal { background-color: #14B8A6; }
        .border-neon-teal { border-color: #14B8A6; }

        /* Neon Glow Effects */
        .text-neon-glow {
            text-shadow: 0 0 5px #14B8A6, 0 0 10px rgba(20, 184, 166, 0.7);
        }

        /* Glowing Card/Container */
        .glow-card {
            border: 1px solid rgba(20, 184, 166, 0.3);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.4);
            background-color: rgba(0, 0, 0, 0.7);
            transition: all 0.3s ease;
        }
        .glow-card:hover {
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.7);
            transform: translateY(-2px);
        }
        .glow-button {
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #14B8A6;
        }
        .glow-button:hover {
            box-shadow: 0 0 20px #14B8A6, 0 0 30px rgba(20, 184, 166, 0.5);
            transform: scale(1.05);
        }

        /* Subtly Animated Background (Matrix/Grid Effect) */
        .background-matrix::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(20, 184, 166, 0.08) 0%, rgba(0, 0, 0, 1) 70%);
            opacity: 0.3;
            animation: moveGradient 20s infinite linear;
            z-index: -2;
        }
        @keyframes moveGradient {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* Particle/Noise Effect (Optional but enhances cyber look) */
        .background-matrix::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAG0lEQVQYV2NkYGD4z8DAwMgAAkYGRjD/AwBqAwC6BgfK5m47gAAAAABJRU5ErkJggg==') repeat;
            opacity: 0.05;
            z-index: -1;
        }

        /* Modal backdrop for immersive feel */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        /* VAPI Toggle Button Styling */
        #vapi-toggle-fixed {
            position: fixed;
            bottom: 6rem; /* Above VAPI widget */
            right: 1.5rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #14B8A6;
            color: black;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 15px #14B8A6;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 15px #14B8A6; }
            50% { transform: scale(1.1); box-shadow: 0 0 25px #14B8A6; }
            100% { transform: scale(1); box-shadow: 0 0 15px #14B8A6; }
        }
    </style>
</head>
<body class="background-matrix">

    <!-- Header / Persistent Navigation -->
    <header class="sticky top-0 z-50 bg-black/90 backdrop-blur-sm border-b border-neon-teal/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <div class="text-3xl font-extrabold text-neon-teal text-neon-glow" data-i18n="header_title">
                CYBERSPACE AI HUB
            </div>
            <div class="flex items-center space-x-4">
                <!-- Language Selector -->
                <select id="language-select" onchange="switchLanguage(this.value)" class="bg-black text-neon-teal border border-neon-teal/50 rounded-md p-2 focus:ring-0 focus:border-neon-teal">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                </select>
                <!-- Settings Button (Placeholder for modal) -->
                <button onclick="toggleModal('settings-modal')" class="p-2 rounded-full text-neon-teal hover:bg-neon-teal/20 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <!-- ------------------------------------------------------------------------------------ -->
        <!-- VIEW 1: Main Hub View (Updated to match image) -->
        <!-- ------------------------------------------------------------------------------------ -->
        <div id="main-hub-view" class="view">
            <div class="text-center mb-12">
                <h1 class="text-6xl md:text-7xl font-black mb-4 text-white text-neon-glow leading-tight" data-i18n="hero_title">
                    Talk with AI. Instant, Global,<br class="hidden sm:block"> Voice-Enabled.
                </h1>
                <p class="text-lg text-white/80 font-light max-w-2xl mx-auto mb-10" data-i18n="hero_subtitle">
                    Experience the future of interaction with our multimodal, voice-powered agent. Click the microphone button in the top corner to start the conversation.
                </p>

                <!-- CTA Buttons (Matching the image) -->
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 mb-20">
                    <button onclick="toggleVapi()" class="glow-button px-8 py-3 bg-white/10 text-white rounded-full font-bold hover:bg-neon-teal/20 transition duration-300">
                        <span data-i18n="btn_toggle">Use Fixed AI Toggle</span>
                    </button>
                    <button onclick="switchView('brainstorm-view')" class="glow-button px-8 py-3 bg-pink-600/50 text-white rounded-full font-bold hover:bg-pink-600/70 transition duration-300">
                        <span data-i18n="btn_brainstorm">AI Brainstorm Ideas</span>
                    </button>
                    <button onclick="switchView('query-view')" class="glow-button px-8 py-3 bg-purple-600/50 text-white rounded-full font-bold hover:bg-purple-600/70 transition duration-300">
                        <span data-i18n="btn_multimodal">Multimodal Query üß¨</span>
                    </button>
                </div>
            </div>

            <!-- System Health & Stats Header -->
            <h2 class="text-center text-3xl font-bold mb-8 text-white text-neon-glow" data-i18n="stats_header">System Health & Stats</h2>

            <!-- System Status Grid (Updated to match image) -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-20">
                <div class="p-4 rounded-xl glow-card text-center">
                    <p class="text-lg opacity-75" data-i18n="stat_vapi_label">VAPI Status</p>
                    <p class="text-4xl font-bold text-green-400 text-neon-glow" id="hub-status" data-i18n="stat_vapi_value">LIVE</p>
                </div>
                <div class="p-4 rounded-xl glow-card text-center">
                    <p class="text-lg opacity-75" data-i18n="stat_uptime_label">Uptime</p>
                    <p class="text-4xl font-bold text-neon-teal" data-i18n="stat_uptime_value">99.9%</p>
                </div>
                <div class="p-4 rounded-xl glow-card text-center">
                    <p class="text-lg opacity-75" data-i18n="stat_model_label">Model</p>
                    <p class="text-4xl font-bold text-neon-teal" data-i18n="stat_model_value">Gemini 2.5</p>
                </div>
                <div class="p-4 rounded-xl glow-card text-center">
                    <p class="text-lg opacity-75" data-i18n="stat_latency_label">Latency</p>
                    <p class="text-4xl font-bold text-neon-teal" data-i18n="stat_latency_value">~200ms</p>
                </div>
            </div>

            <!-- Key Capabilities Header -->
            <h2 class="text-center text-3xl font-bold mb-8 text-white text-neon-glow" data-i18n="capabilities_header">Key Capabilities</h2>

            <!-- Key Capabilities Grid (Matching the image) -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Card 1: Real-Time Voice -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_voice_title">Real-Time Voice</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_voice_desc">Engage in fully natural conversations, seamlessly looking for answers or acting like a human.</p>
                </div>
                <!-- Card 2: Multi-Language -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_lang_title">Multi-Language</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_lang_desc">Supports multiple global languages, enabling truly multilingual communication.</p>
                </div>
                <!-- Card 3: Voice + Chat Modes -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_modes_title">Voice + Chat Modes</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_modes_desc">Instantly switch between voice input and text chat within the same interface.</p>
                </div>
                <!-- Card 4: Live Transcript -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_transcript_title">Live Transcript</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_transcript_desc">View a real-time transcript of your conversation for clarity and record keeping.</p>
                </div>
                <!-- Card 5: Futuristic Design -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_design_title">Futuristic Design</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_design_desc">Enjoy a sleek, dark cyberpunk UI with neon glows, highlights and smooth animations.</p>
                </div>
                <!-- Card 6: Fully Responsive -->
                <div class="p-6 rounded-xl glow-card">
                    <h3 class="text-2xl font-bold mb-2 text-neon-teal" data-i18n="cap_responsive_title">Fully Responsive</h3>
                    <p class="text-sm opacity-80" data-i18n="cap_responsive_desc">Optimized for flawless viewing and interaction on all devices, from mobile to desktop.</p>
                </div>
            </div>
        </div>

        <!-- ------------------------------------------------------------------------------------ -->
        <!-- VIEW 2: Brainstorm View -->
        <!-- ------------------------------------------------------------------------------------ -->
        <div id="brainstorm-view" class="view hidden">
            <button onclick="switchView('main-hub-view')" class="glow-button px-4 py-2 mb-8 bg-neon-teal/20 text-neon-teal rounded-full text-sm hover:bg-neon-teal/50" data-i18n="btn_home">‚Üê RETURN TO HUB</button>
            <h1 class="text-4xl font-bold mb-6 text-neon-teal text-neon-glow" data-i18n="brain_header">IDEA MATRIX BRAINSTORM</h1>

            <div class="glow-card p-6 rounded-xl">
                <p class="mb-4 text-white/80" data-i18n="brain_prompt">Enter a topic to generate three creative concepts:</p>
                <form onsubmit="handleBrainstorm(event)" id="brainstorm-form">
                    <input type="text" id="brainstorm-input" required class="w-full p-3 mb-4 rounded-md bg-black border border-neon-teal/50 text-white focus:outline-none focus:ring-2 focus:ring-neon-teal" placeholder="e.g., A novel concept for renewable energy storage" data-i18n-placeholder="brain_placeholder">
                    <button type="submit" class="glow-button w-full bg-neon-teal text-black font-bold py-3 rounded-md hover:bg-neon-teal/80 transition duration-300" data-i18n="brain_submit">GENERATE CONCEPTS</button>
                </form>

                <div id="brainstorm-output-container" class="mt-8 pt-4 border-t border-neon-teal/50">
                    <p class="text-white/60 text-center" id="brainstorm-status" data-i18n="brain_waiting">Awaiting Input...</p>
                    <div id="brainstorm-output" class="prose prose-invert max-w-none text-white mt-4">
                        <!-- AI Generated list will go here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ------------------------------------------------------------------------------------ -->
        <!-- VIEW 3: Query View / Command Center -->
        <!-- ------------------------------------------------------------------------------------ -->
        <div id="query-view" class="view hidden">
            <button onclick="switchView('main-hub-view')" class="glow-button px-4 py-2 mb-8 bg-neon-teal/20 text-neon-teal rounded-full text-sm hover:bg-neon-teal/50" data-i18n="btn_home">‚Üê RETURN TO HUB</button>
            <h1 class="text-4xl font-bold mb-6 text-neon-teal text-neon-glow" data-i18n="query_header">CORE COMMAND CENTER</h1>

            <div class="glow-card p-6 rounded-xl">
                <form onsubmit="handleCommandCenter(event)" id="query-form">
                    <!-- Mode Selector -->
                    <div class="mb-4 flex space-x-4">
                        <label class="text-white/80" data-i18n="query_mode_label">Select Mode:</label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="query_mode" value="general" checked class="form-radio text-neon-teal bg-black border-neon-teal/50 focus:ring-neon-teal">
                            <span class="ml-2 text-white" data-i18n="query_mode_general">General Analysis</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="query_mode" value="code" class="form-radio text-neon-teal bg-black border-neon-teal/50 focus:ring-neon-teal">
                            <span class="ml-2 text-white" data-i18n="query_mode_code">Code Snippet</span>
                        </label>
                    </div>

                    <!-- Text Input -->
                    <textarea id="query-input-text" required rows="3" class="w-full p-3 mb-4 rounded-md bg-black border border-neon-teal/50 text-white focus:outline-none focus:ring-2 focus:ring-neon-teal" placeholder="Enter your command (e.g., Explain quantum computing, or Write a Python function for a quicksort)." data-i18n-placeholder="query_text_placeholder"></textarea>

                    <!-- Image Input -->
                    <label for="query-input-image" class="block mb-2 text-white/80" data-i18n="query_image_label">Upload Image (Optional for multimodal analysis):</label>
                    <input type="file" id="query-input-image" accept="image/*" class="w-full p-2 mb-4 rounded-md bg-black border border-neon-teal/50 text-white/70 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-neon-teal file:text-black hover:file:bg-neon-teal/80">

                    <button type="submit" class="glow-button w-full bg-neon-teal text-black font-bold py-3 rounded-md hover:bg-neon-teal/80 transition duration-300" data-i18n="query_submit">EXECUTE COMMAND</button>
                </form>

                <div id="query-output-container" class="mt-8 pt-4 border-t border-neon-teal/50">
                    <p class="text-white/60 text-center" id="query-status" data-i18n="query_waiting">Awaiting Command Execution...</p>

                    <!-- TTS Button -->
                    <div id="tts-controls" class="hidden flex justify-end mb-4">
                        <button onclick="handleTTS()" id="tts-button" class="flex items-center px-3 py-1 bg-neon-teal/20 text-neon-teal rounded-full text-sm glow-button hover:bg-neon-teal/50 transition duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586L9 5.586A1 1 0 0110 6v12a1 1 0 01-1 1l-3.414-3.414z" /></svg>
                            <span data-i18n="query_tts_read">Read Aloud üîä</span>
                        </button>
                        <audio id="tts-audio" class="hidden" controls></audio>
                    </div>

                    <!-- AI Output -->
                    <div id="query-output" class="prose prose-invert max-w-none text-white mt-4">
                        <!-- AI Generated content, code block, or grounding citations will go here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ------------------------------------------------------------------------------------ -->
    <!-- SETTINGS MODAL -->
    <!-- ------------------------------------------------------------------------------------ -->
    <div id="settings-modal" class="hidden fixed inset-0 z-[100] modal-backdrop flex items-center justify-center p-4">
        <div class="glow-card p-6 w-full max-w-lg rounded-xl">
            <h2 class="text-3xl font-bold mb-4 text-neon-teal text-neon-glow" data-i18n="settings_title">SYSTEM SETTINGS</h2>
            <div class="space-y-4">
                <div class="p-4 bg-black/50 rounded-lg border border-neon-teal/20">
                    <h3 class="font-semibold text-white mb-2" data-i18n="settings_source_code">HTML Source Code Utility</h3>
                    <p class="text-sm text-white/70 mb-3" data-i18n="settings_source_desc">Copy the complete source code of this application to your clipboard.</p>
                    <button onclick="copySourceCode()" class="glow-button w-full bg-gray-800 text-neon-teal font-bold py-2 rounded-md hover:bg-gray-700 transition duration-300 mb-2">
                        <span id="copy-btn-text" data-i18n="settings_copy_btn">COPY HTML SOURCE TO CLIPBOARD</span>
                    </button>
                    <!-- NEW DOWNLOAD BUTTON -->
                    <button onclick="downloadSourceCode()" class="glow-button w-full bg-neon-teal/80 text-black font-bold py-2 rounded-md hover:bg-neon-teal transition duration-300">
                        <span data-i18n="settings_download_btn">DOWNLOAD WEBSITE FILE</span>
                    </button>
                </div>

                <div class="p-4 bg-black/50 rounded-lg border border-neon-teal/20">
                    <h3 class="font-semibold text-white mb-2" data-i18n="settings_key_info">API Key Information</h3>
                    <p class="text-sm text-white/70" data-i18n="settings_key_desc">All AI functions are powered by the **Gemini API**. The key is handled securely by the canvas environment.</p>
                </div>
            </div>
            <button onclick="toggleModal('settings-modal')" class="mt-6 w-full py-2 bg-red-800/50 text-white rounded-md hover:bg-red-800 transition duration-300" data-i18n="settings_close">CLOSE INTERFACE</button>
        </div>
    </div>


    <!-- ------------------------------------------------------------------------------------ -->
    <!-- VAPI WIDGET INTEGRATION (Required at bottom of body) -->
    <!-- ------------------------------------------------------------------------------------ -->
    <vapi-widget
        public-key="b7e0c1dd-df9e-4c64-a99e-000cd099f30d"
        assistant-id="058f5c02-6154-4277-8bf6-3db5b02e064c"
        mode="voice"
        theme="dark"
        base-bg-color="#000000"
        accent-color="#14B8A6"
        cta-button-color="#000000"
        cta-button-text-color="#ffffff"
        border-radius="large"
        size="full"
        position="bottom-right"
        title="TALK WITH AI"
        start-button-text="Start"
        end-button-text="End Call"
        chat-first-message="Hey, How can I help you today?"
        chat-placeholder="Type your message..."
        voice-show-transcript="true"
        consent-required="true"
        consent-title="Terms and conditions"
        consent-content="By clicking 'Agree,' and each time I interact with this AI agent, I consent to the recording, storage, and sharing of my communications with third-party service providers, and as otherwise described in our Terms of Service."
        consent-storage-key="vapi_widget_consent"
    ></vapi-widget>
    <!-- VAPI Script: ASYNC REMOVED FOR FASTER INITIALIZATION -->
    <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" type="text/javascript"></script>

    <!-- Fixed VAPI Toggle Button -->
    <div id="vapi-toggle-fixed" onclick="toggleVapi()">
        <span id="vapi-toggle-icon">TALK</span>
    </div>

    <!-- ------------------------------------------------------------------------------------ -->
    <!-- JAVASCRIPT LOGIC -->
    <!-- ------------------------------------------------------------------------------------ -->
    <script>
        const API_KEY = "AIzaSyBUa3I3oPt0K4kUxUbLMnFcN8kwIK5uUbg"; // Placeholder, key is supplied by the canvas environment
        const API_BASE_URL = "https://generativelanguage.googleapis.com/v1beta/models";

        // Global state for views
        let currentView = 'main-hub-view';

        // ----------------------------------------------------------------------------
        // 1. UTILITY FUNCTIONS (Exponential Backoff, Audio Conversion)
        // ----------------------------------------------------------------------------

        /**
         * Fetches a resource using exponential backoff retry mechanism.
         * @param {string} url - The URL to fetch.
         * @param {object} options - Fetch options.
         * @param {number} retries - Number of retries (default 3).
         * @returns {Promise<Response>}
         */
        async function exponentialBackoffFetch(url, options, retries = 3) {
            // Include API Key in URL here to ensure it's passed correctly
            const fetchUrl = url + `?key=${API_KEY}`;
            
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(fetchUrl, options);
                    if (response.status === 429) { // Rate limit
                        throw new Error(`Rate limit hit (429). Retrying in ${Math.pow(2, i)}s...`);
                    }
                    if (!response.ok) {
                        const errorBody = await response.json().catch(() => ({}));
                        throw new Error(`HTTP Error: ${response.status} - ${errorBody.error?.message || response.statusText}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) {
                        console.error("Max retries reached. Request failed:", error);
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    console.warn(`Attempt ${i + 1} failed: ${error.message}. Retrying in ${Math.ceil(delay / 1000)}s.`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        /** Converts a base64 string to an ArrayBuffer. */
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        /**
         * Converts raw PCM 16-bit audio data (signed) into a WAV Blob.
         * @param {Int16Array} pcm16 - Raw PCM data.
         * @param {number} sampleRate - Sample rate (e.g., 24000).
         * @returns {Blob} WAV file blob.
         */
        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const numSamples = pcm16.length;
            const dataSize = numSamples * 2; // 16-bit, 2 bytes per sample

            // Create ArrayBuffer for WAV file
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            let offset = 0;

            // RIFF chunk
            writeString(view, offset, 'RIFF'); offset += 4;
            view.setUint32(offset, 36 + dataSize, true); offset += 4; // ChunkSize
            writeString(view, offset, 'WAVE'); offset += 4;

            // FMT chunk
            writeString(view, offset, 'fmt '); offset += 4;
            view.setUint32(offset, 16, true); offset += 4; // Subchunk1Size (16 for PCM)
            view.setUint16(offset, 1, true); offset += 2; // AudioFormat (1 for PCM)
            view.setUint16(offset, numChannels, true); offset += 2; // NumChannels
            view.setUint32(offset, sampleRate, true); offset += 4; // SampleRate
            view.setUint32(offset, sampleRate * numChannels * 2, true); offset += 4; // ByteRate
            view.setUint16(offset, numChannels * 2, true); offset += 2; // BlockAlign
            view.setUint16(offset, 16, true); offset += 2; // BitsPerSample (16 bit)

            // DATA chunk
            writeString(view, offset, 'data'); offset += 4;
            view.setUint32(offset, dataSize, true); offset += 4; // Subchunk2Size

            // Write PCM data
            for (let i = 0; i < numSamples; i++, offset += 2) {
                view.setInt16(offset, pcm16[i], true);
            }

            return new Blob([buffer], { type: 'audio/wav' });

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }
        }


        // ----------------------------------------------------------------------------
        // 2. VIEW & MODAL MANAGEMENT
        // ----------------------------------------------------------------------------

        function switchView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            currentView = viewId;
            window.scrollTo(0, 0); // Scroll to top on view switch
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.toggle('hidden');
        }

        // ----------------------------------------------------------------------------
        // 3. VAPI WIDGET TOGGLE
        // ----------------------------------------------------------------------------

        const VAPI_TAG_NAME = 'vapi-widget';

        /**
         * Reliably finds and returns the VAPI widget element using polling.
         * @param {number} timeoutMs - Max time to wait.
         * @returns {Promise<HTMLElement|null>}
         */
        function findVapiWidget(timeoutMs = 8000) {
            return new Promise((resolve) => {
                const intervalTime = 200;
                let elapsed = 0;

                const checkWidget = () => {
                    const widget = document.querySelector(VAPI_TAG_NAME);
                    // Check if widget is available AND has the .start method attached by the SDK
                    if (widget && typeof widget.start === 'function') {
                        return resolve(widget);
                    }
                    elapsed += intervalTime;
                    if (elapsed < timeoutMs) {
                        setTimeout(checkWidget, intervalTime);
                    } else {
                        console.error("VAPI widget not found or not fully initialized within timeout.");
                        resolve(null);
                    }
                };

                checkWidget();
            });
        }

        /** Toggles the VAPI widget's start/end call state. */
        async function toggleVapi() {
            const widget = await findVapiWidget();
            const toggleIcon = document.getElementById('vapi-toggle-icon');

            if (widget) {
                // Check current state (assuming 'end' means it's running)
                const isRunning = widget.getAttribute('state') === 'end';

                if (isRunning) {
                    widget.end();
                    toggleIcon.textContent = 'TALK';
                    toggleIcon.classList.remove('text-red-400');
                    toggleIcon.classList.add('text-black');
                    widget.style.boxShadow = '0 0 15px #14B8A6';
                } else {
                    widget.start();
                    toggleIcon.textContent = 'END';
                    toggleIcon.classList.add('text-red-400');
                    toggleIcon.classList.remove('text-black');
                    widget.style.boxShadow = '0 0 20px rgba(255, 0, 0, 0.8)';
                }
            } else {
                console.error("Cannot toggle VAPI: Widget not initialized.");
            }
        }

        // ----------------------------------------------------------------------------
        // 4. LOCALIZATION DATA & LOGIC
        // ----------------------------------------------------------------------------

        const languageData = {
            en: {
                title: "Cyberspace AI Hub",
                header_title: "CYBERSPACE AI HUB",
                
                // NEW HERO CONTENT
                hero_title: "Talk with AI. Instant, Global, Voice-Enabled.",
                hero_subtitle: "Experience the future of interaction with our multimodal, voice-powered agent. Click the microphone button in the top corner to start the conversation.",
                btn_toggle: "Use Fixed AI Toggle",
                btn_brainstorm: "AI Brainstorm Ideas",
                btn_multimodal: "Multimodal Query üß¨",

                // NEW STATS CONTENT
                stats_header: "System Health & Stats",
                stat_vapi_label: "VAPI Status",
                stat_vapi_value: "LIVE",
                stat_uptime_label: "Uptime",
                stat_uptime_value: "99.9%",
                stat_model_label: "Model",
                stat_model_value: "Gemini 2.5",
                stat_latency_label: "Latency",
                stat_latency_value: "~200ms",

                // NEW CAPABILITIES CONTENT
                capabilities_header: "Key Capabilities",
                cap_voice_title: "Real-Time Voice",
                cap_voice_desc: "Engage in fully natural conversations, seamlessly looking for answers or acting like a human.",
                cap_lang_title: "Multi-Language",
                cap_lang_desc: "Supports multiple global languages, enabling truly multilingual communication.",
                cap_modes_title: "Voice + Chat Modes",
                cap_modes_desc: "Instantly switch between voice input and text chat within the same interface.",
                cap_transcript_title: "Live Transcript",
                cap_transcript_desc: "View a real-time transcript of your conversation for clarity and record keeping.",
                cap_design_title: "Futuristic Design",
                cap_design_desc: "Enjoy a sleek, dark cyberpunk UI with neon glows, highlights and smooth animations.",
                cap_responsive_title: "Fully Responsive",
                cap_responsive_desc: "Optimized for flawless viewing and interaction on all devices, from mobile to desktop.",


                // OLD CONTENT (retained for other views)
                btn_home: "‚Üê RETURN TO HUB",
                brain_header: "IDEA MATRIX BRAINSTORM",
                brain_prompt: "Enter a topic to generate three creative concepts:",
                brain_placeholder: "e.g., A novel concept for renewable energy storage",
                brain_submit: "GENERATE CONCEPTS",
                brain_waiting: "Awaiting Input...",
                query_header: "CORE COMMAND CENTER",
                query_mode_label: "Select Mode:",
                query_mode_general: "General Analysis",
                query_mode_code: "Code Snippet",
                query_text_placeholder: "Enter your command (e.g., Explain quantum computing, or Write a Python function for a quicksort).",
                query_image_label: "Upload Image (Optional for multimodal analysis):",
                query_submit: "EXECUTE COMMAND",
                query_waiting: "Awaiting Command Execution...",
                query_tts_read: "Read Aloud üîä",
                query_citation_header: "Grounding Sources:",
                settings_title: "SYSTEM SETTINGS",
                settings_source_code: "HTML Source Code Utility",
                settings_source_desc: "Copy the complete source code of this application to your clipboard.",
                settings_copy_btn: "COPY HTML SOURCE TO CLIPBOARD",
                settings_download_btn: "DOWNLOAD WEBSITE FILE",
                settings_key_info: "API Key Information",
                settings_key_desc: "All AI functions are powered by the **Gemini API**. The key is handled securely by the canvas environment.",
                settings_close: "CLOSE INTERFACE"
            },
            hi: {
                title: "‡§∏‡§æ‡§á‡§¨‡§∞‡§∏‡•ç‡§™‡•á‡§∏ ‡§è‡§Ü‡§à ‡§π‡§¨",
                header_title: "‡§∏‡§æ‡§á‡§¨‡§∞‡§∏‡•ç‡§™‡•á‡§∏ ‡§è‡§Ü‡§à ‡§π‡§¨",
                
                // NEW HERO CONTENT
                hero_title: "‡§è‡§Ü‡§à ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§§‡•ç‡§µ‡§∞‡§ø‡§§, ‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï, ‡§µ‡•â‡§á‡§∏-‡§∏‡§ï‡•ç‡§∑‡§Æ‡•§",
                hero_subtitle: "‡§π‡§Æ‡§æ‡§∞‡•á ‡§Æ‡§≤‡•ç‡§ü‡•Ä‡§Æ‡•â‡§°‡§≤, ‡§µ‡•â‡§á‡§∏-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§è‡§ú‡•á‡§Ç‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡•á ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞‡•Ä ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡§º‡•ã‡§® ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                btn_toggle: "‡§´‡§ø‡§ï‡•ç‡§∏‡•ç‡§° ‡§è‡§Ü‡§à ‡§ü‡•â‡§ó‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç",
                btn_brainstorm: "‡§è‡§Ü‡§à ‡§Æ‡§Ç‡§•‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞",
                btn_multimodal: "‡§¨‡§π‡•Å‡§µ‡§ø‡§ß ‡§™‡•ç‡§∞‡§∂‡•ç‡§® üß¨",

                // NEW STATS CONTENT
                stats_header: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§î‡§∞ ‡§Ü‡§Å‡§ï‡§°‡§º‡•á",
                stat_vapi_label: "‡§µ‡•Ä‡§è‡§™‡•Ä‡§Ü‡§à ‡§∏‡•ç‡§•‡§ø‡§§‡§ø",
                stat_vapi_value: "‡§≤‡§æ‡§á‡§µ",
                stat_uptime_label: "‡§Ö‡§™‡§ü‡§æ‡§á‡§Æ",
                stat_uptime_value: "99.9%",
                stat_model_label: "‡§Æ‡•â‡§°‡§≤",
                stat_model_value: "‡§ú‡•á‡§Æ‡§ø‡§®‡•Ä 2.5",
                stat_latency_label: "‡§µ‡§ø‡§≤‡§Ç‡§¨‡§§‡§æ",
                stat_latency_value: "~200ms",

                // NEW CAPABILITIES CONTENT
                capabilities_header: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Ç",
                cap_voice_title: "‡§∞‡•Ä‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§µ‡•â‡§Ø‡§∏",
                cap_voice_desc: "‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§ï‡•É‡§§‡§ø‡§ï ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç, ‡§∏‡§π‡§ú‡§§‡§æ ‡§∏‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§Ø‡§æ ‡§Æ‡§æ‡§®‡§µ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡•á‡§Ç‡•§",
                cap_lang_title: "‡§¨‡§π‡•Å-‡§≠‡§æ‡§∑‡§æ",
                cap_lang_desc: "‡§ï‡§à ‡§µ‡•à‡§∂‡•ç‡§µ‡§ø‡§ï ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§≠‡§æ‡§∑‡•Ä ‡§∏‡§Ç‡§ö‡§æ‡§∞ ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§",
                cap_modes_title: "‡§µ‡•â‡§Ø‡§∏ + ‡§ö‡•à‡§ü ‡§Æ‡•ã‡§°",
                cap_modes_desc: "‡§è‡§ï ‡§π‡•Ä ‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏ ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§µ‡•â‡§Ø‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§î‡§∞ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ö‡•à‡§ü ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§",
                cap_transcript_title: "‡§≤‡§æ‡§á‡§µ ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡•á‡§ñ",
                cap_transcript_desc: "‡§∏‡•ç‡§™‡§∑‡•ç‡§ü‡§§‡§æ ‡§î‡§∞ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡§æ ‡§∞‡•Ä‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§™‡•ç‡§∞‡§§‡§ø‡§≤‡•á‡§ñ ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
                cap_design_title: "‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§¶‡•Ä ‡§°‡§ø‡§ú‡§æ‡§á‡§®",
                cap_design_desc: "‡§®‡§ø‡§Ø‡•â‡§® ‡§ö‡§Æ‡§ï, ‡§π‡§æ‡§á‡§≤‡§æ‡§á‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§∏‡§π‡§ú ‡§è‡§®‡§ø‡§Æ‡•á‡§∂‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§ö‡§ø‡§ï‡§®‡§æ, ‡§ó‡§π‡§∞‡§æ ‡§∏‡§æ‡§á‡§¨‡§∞‡§™‡§Ç‡§ï ‡§Ø‡•Ç‡§Ü‡§à ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á‡§Ç‡•§",
                cap_responsive_title: "‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§∂‡•Ä‡§≤",
                cap_responsive_desc: "‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§∏‡•á ‡§°‡•á‡§∏‡•ç‡§ï‡§ü‡•â‡§™ ‡§§‡§ï, ‡§∏‡§≠‡•Ä ‡§â‡§™‡§ï‡§∞‡§£‡•ã‡§Ç ‡§™‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡§π‡•Ä‡§® ‡§¶‡•á‡§ñ‡§®‡•á ‡§î‡§∞ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤‡§ø‡§§‡•§",


                // OLD CONTENT (retained for other views)
                btn_home: "‚Üê ‡§π‡§¨ ‡§™‡§∞ ‡§≤‡•å‡§ü‡•á‡§Ç",
                brain_header: "‡§Ü‡§á‡§°‡§ø‡§Ø‡§æ ‡§Æ‡•à‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§Æ‡§Ç‡§•‡§®",
                brain_prompt: "‡§§‡•Ä‡§® ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§è‡§Å ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:",
                brain_placeholder: "‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§Ö‡§ï‡•ç‡§∑‡§Ø ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§≠‡§Ç‡§°‡§æ‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ",
                brain_submit: "‡§Ö‡§µ‡§ß‡§æ‡§∞‡§£‡§æ‡§è‡§Å ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç",
                brain_waiting: "‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§π‡•à...",
                query_header: "‡§ï‡•ã‡§∞ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§∏‡•á‡§Ç‡§ü‡§∞",
                query_mode_label: "‡§Æ‡•ã‡§° ‡§ö‡•Å‡§®‡•á‡§Ç:",
                query_mode_general: "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£",
                query_mode_code: "‡§ï‡•ã‡§° ‡§∏‡•ç‡§®‡§ø‡§™‡•á‡§ü",
                query_text_placeholder: "‡§Ö‡§™‡§®‡§æ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§ï‡•ç‡§µ‡§æ‡§Ç‡§ü‡§Æ ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§ø‡§Ç‡§ó ‡§∏‡§Æ‡§ù‡§æ‡§è‡§Å, ‡§Ø‡§æ ‡§ï‡•ç‡§µ‡§ø‡§ï‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡§æ‡§Ø‡§•‡§® ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§≤‡§ø‡§ñ‡•á‡§Ç)‡•§",
                query_image_label: "‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (‡§Æ‡§≤‡•ç‡§ü‡•Ä‡§Æ‡•â‡§°‡§≤ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï):",
                query_submit: "‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                query_waiting: "‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§π‡•à...",
                query_tts_read: "‡§ú‡§º‡•ã‡§∞ ‡§∏‡•á ‡§™‡§¢‡§º‡•á‡§Ç üîä",
                query_citation_header: "‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§∞‡•ã‡§§:",
                settings_title: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                settings_source_code: "‡§è‡§ö‡§ü‡•Ä‡§è‡§Æ‡§è‡§≤ ‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§ï‡•ã‡§° ‡§â‡§™‡§Ø‡•ã‡§ó‡§ø‡§§‡§æ",
                settings_source_desc: "‡§á‡§∏ ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§ï‡•ã‡§° ‡§Ö‡§™‡§®‡•á ‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç‡•§",
                settings_copy_btn: "‡§è‡§ö‡§ü‡•Ä‡§è‡§Æ‡§è‡§≤ ‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç",
                settings_download_btn: "‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§´‡§º‡§æ‡§á‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                settings_key_info: "‡§è‡§™‡•Ä‡§Ü‡§à ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
                settings_key_desc: "All AI functions are powered by the **Gemini API**. The key is handled securely by the canvas environment.",
                settings_close: "‡§á‡§Ç‡§ü‡§∞‡§´‡§º‡•á‡§∏ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç"
            },
            te: {
                title: "‡∞∏‡±à‡∞¨‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞™‡±á‡∞∏‡±ç AI ‡∞π‡∞¨‡±ç",
                header_title: "‡∞∏‡±à‡∞¨‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞™‡±á‡∞∏‡±ç AI ‡∞π‡∞¨‡±ç",
                
                // NEW HERO CONTENT
                hero_title: "AI‡∞§‡±ã ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞Ç‡∞°‡∞ø. ‡∞§‡∞ï‡±ç‡∞∑‡∞£, ‡∞™‡±ç‡∞∞‡∞™‡∞Ç‡∞ö, ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç-‡∞é‡∞®‡±á‡∞¨‡±Å‡∞≤‡±ç‡∞°‡±ç.",
                hero_subtitle: "‡∞Æ‡∞æ ‡∞Æ‡∞≤‡±ç‡∞ü‡±Ä‡∞Æ‡±ã‡∞°‡∞≤‡±ç, ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç-‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞ó‡∞≤ ‡∞è‡∞ú‡±Ü‡∞Ç‡∞ü‡±ç‚Äå‡∞§‡±ã ‡∞á‡∞Ç‡∞ü‡∞∞‡∞æ‡∞ï‡±ç‡∞∑‡∞®‡±ç ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞≠‡∞µ‡∞ø‡∞∑‡±ç‡∞Ø‡∞§‡±ç‡∞§‡±Å‡∞®‡±Å ‡∞Ö‡∞®‡±Å‡∞≠‡∞µ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø. ‡∞∏‡∞Ç‡∞≠‡∞æ‡∞∑‡∞£‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±à ‡∞Æ‡±Ç‡∞≤‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞® ‡∞Æ‡±à‡∞ï‡±ç‡∞∞‡±ã‡∞´‡±ã‡∞®‡±ç ‡∞¨‡∞ü‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞ï‡±ç‡∞≤‡∞ø‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
                btn_toggle: "‡∞´‡∞ø‡∞ï‡±ç‡∞∏‡±ç‚Äå‡∞°‡±ç AI ‡∞ü‡±ã‡∞ó‡±Å‡∞≤‡±ç‚Äå‡∞®‡±Å ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
                btn_brainstorm: "AI ‡∞¨‡±ç‡∞∞‡±Ü‡∞Ø‡∞ø‡∞®‡±ç‚Äå‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±ç‡∞Æ‡±ç ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡±Å",
                btn_multimodal: "‡∞Æ‡∞≤‡±ç‡∞ü‡±Ä‡∞Æ‡±ã‡∞°‡∞≤‡±ç ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞® üß¨",

                // NEW STATS CONTENT
                stats_header: "‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø‡∞Ç & ‡∞ó‡∞£‡∞æ‡∞Ç‡∞ï‡∞æ‡∞≤‡±Å",
                stat_vapi_label: "VAPI ‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø",
                stat_vapi_value: "‡∞≤‡±à‡∞µ‡±ç",
                stat_uptime_label: "‡∞Ö‡∞™‡±ç‚Äå‡∞ü‡±à‡∞Æ‡±ç",
                stat_uptime_value: "99.9%",
                stat_model_label: "‡∞Æ‡±ã‡∞°‡∞≤‡±ç",
                stat_model_value: "‡∞ú‡±Ü‡∞Æ‡∞ø‡∞®‡∞ø 2.5",
                stat_latency_label: "‡∞ú‡∞æ‡∞™‡±ç‡∞Ø‡∞Ç",
                stat_latency_value: "~200ms",

                // NEW CAPABILITIES CONTENT
                capabilities_header: "‡∞ï‡±Ä ‡∞∏‡∞æ‡∞Æ‡∞∞‡±ç‡∞•‡±ç‡∞Ø‡∞æ‡∞≤‡±Å",
                cap_voice_title: "‡∞∞‡∞ø‡∞Ø‡∞≤‡±ç-‡∞ü‡±à‡∞Æ‡±ç ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç",
                cap_voice_desc: "‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø‡∞ó‡∞æ ‡∞∏‡∞π‡∞ú‡∞Æ‡±à‡∞® ‡∞∏‡∞Ç‡∞≠‡∞æ‡∞∑‡∞£‡∞≤‡∞≤‡±ã ‡∞™‡∞æ‡∞≤‡±ç‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø, ‡∞∏‡∞ú‡∞æ‡∞µ‡±Å‡∞ó‡∞æ ‡∞∏‡∞Æ‡∞æ‡∞ß‡∞æ‡∞®‡∞æ‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡±Ü‡∞§‡∞ï‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞®‡∞ø‡∞∑‡∞ø‡∞≤‡∞æ ‡∞µ‡±ç‡∞Ø‡∞µ‡∞π‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
                cap_lang_title: "‡∞¨‡∞π‡±Å‡∞≥ ‡∞≠‡∞æ‡∞∑",
                cap_lang_desc: "‡∞¨‡∞π‡±Å‡∞≥ ‡∞™‡±ç‡∞∞‡∞™‡∞Ç‡∞ö ‡∞≠‡∞æ‡∞∑‡∞≤‡∞ï‡±Å ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø, ‡∞®‡∞ø‡∞ú‡∞Æ‡±à‡∞® ‡∞¨‡∞π‡±Å‡∞≠‡∞æ‡∞∑‡∞æ ‡∞ï‡∞Æ‡±ç‡∞Ø‡±Ç‡∞®‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.",
                cap_modes_title: "‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç + ‡∞ö‡∞æ‡∞ü‡±ç ‡∞Æ‡±ã‡∞°‡±ç‚Äå‡∞≤‡±Å",
                cap_modes_desc: "‡∞í‡∞ï‡±á ‡∞á‡∞Ç‡∞ü‡∞∞‡±ç‚Äå‡∞´‡±á‡∞∏‡±ç‚Äå‡∞≤‡±ã ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞á‡∞®‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞ü‡±Ü‡∞ï‡±ç‡∞∏‡±ç‡∞ü‡±ç ‡∞ö‡∞æ‡∞ü‡±ç ‡∞Æ‡∞ß‡±ç‡∞Ø ‡∞§‡∞ï‡±ç‡∞∑‡∞£‡∞Æ‡±á ‡∞Æ‡∞æ‡∞∞‡∞Ç‡∞°‡∞ø.",
                cap_transcript_title: "‡∞≤‡±à‡∞µ‡±ç ‡∞ü‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞∏‡±ç‚Äå‡∞ï‡±ç‡∞∞‡∞ø‡∞™‡±ç‡∞ü‡±ç",
                cap_transcript_desc: "‡∞∏‡±ç‡∞™‡∞∑‡±ç‡∞ü‡∞§ ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∞‡∞ø‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±Å ‡∞â‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞≠‡∞æ‡∞∑‡∞£ ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞®‡∞ø‡∞ú-‡∞∏‡∞Æ‡∞Ø ‡∞ü‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞∏‡±ç‚Äå‡∞ï‡±ç‡∞∞‡∞ø‡∞™‡±ç‡∞ü‡±ç‚Äå‡∞®‡±Å ‡∞µ‡±Ä‡∞ï‡±ç‡∞∑‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
                cap_design_title: "‡∞≠‡∞µ‡∞ø‡∞∑‡±ç‡∞Ø‡∞§‡±ç ‡∞°‡∞ø‡∞ú‡±à‡∞®‡±ç",
                cap_design_desc: "‡∞®‡∞ø‡∞Ø‡∞æ‡∞®‡±ç ‡∞ó‡±ç‡∞≤‡±ã‡∞∏‡±ç, ‡∞π‡±à‡∞≤‡±à‡∞ü‡±ç‚Äå‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞Æ‡±É‡∞¶‡±Å‡∞µ‡±à‡∞® ‡∞Ø‡∞æ‡∞®‡∞ø‡∞Æ‡±á‡∞∑‡∞®‡±ç‚Äå‡∞≤‡∞§‡±ã ‡∞∏‡±ä‡∞ó‡∞∏‡±à‡∞®, ‡∞°‡∞æ‡∞∞‡±ç‡∞ï‡±ç ‡∞∏‡±à‡∞¨‡∞∞‡±ç‚Äå‡∞™‡∞Ç‡∞ï‡±ç UI‡∞®‡∞ø ‡∞Ü‡∞∏‡±ç‡∞µ‡∞æ‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
                cap_responsive_title: "‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø‡∞ó‡∞æ ‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡±á",
                cap_responsive_desc: "‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞°‡±Ü‡∞∏‡±ç‡∞ï‡±ç‚Äå‡∞ü‡∞æ‡∞™‡±ç ‡∞µ‡∞∞‡∞ï‡±Å, ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞™‡∞∞‡∞ø‡∞ï‡∞∞‡∞æ‡∞≤‡±ç‡∞≤‡±ã ‡∞¶‡±ã‡∞∑‡∞∞‡∞π‡∞ø‡∞§ ‡∞µ‡±Ä‡∞ï‡±ç‡∞∑‡∞£ ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞á‡∞Ç‡∞ü‡∞∞‡∞æ‡∞ï‡±ç‡∞∑‡∞®‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Ü‡∞™‡±ç‡∞ü‡∞ø‡∞Æ‡±à‡∞ú‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
                
                // OLD CONTENT (retained for other views)
                btn_home: "‚Üê ‡∞π‡∞¨‡±ç‚Äå‡∞ï‡±Å ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≤‡∞Ç‡∞°‡∞ø",
                brain_header: "‡∞ê‡∞°‡∞ø‡∞Ø‡∞æ ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞ü‡±ç‡∞∞‡∞ø‡∞ï‡±ç‡∞∏‡±ç ‡∞¨‡±ç‡∞∞‡±Ü‡∞Ø‡∞ø‡∞®‡±ç‚Äå‡∞∏‡±ç‡∞ü‡∞æ‡∞∞‡±ç‡∞Æ‡±ç",
                brain_prompt: "‡∞Æ‡±Ç‡∞°‡±Å ‡∞∏‡±É‡∞ú‡∞®‡∞æ‡∞§‡±ç‡∞Æ‡∞ï ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡∞®‡±Å ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞í‡∞ï ‡∞Ö‡∞Ç‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø:",
                brain_placeholder: "‡∞â‡∞¶‡∞æ: ‡∞™‡±Å‡∞®‡∞∞‡±Å‡∞§‡±ç‡∞™‡∞æ‡∞¶‡∞ï ‡∞á‡∞Ç‡∞ß‡∞® ‡∞®‡∞ø‡∞≤‡±ç‡∞µ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞í‡∞ï ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®",
                brain_submit: "‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡∞®‡±Å ‡∞∞‡±Ç‡∞™‡±ä‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
                brain_waiting: "‡∞á‡∞®‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡±á‡∞ö‡∞ø ‡∞â‡∞Ç‡∞¶‡∞ø...",
                query_header: "‡∞ï‡±ã‡∞∞‡±ç ‡∞ï‡∞Æ‡∞æ‡∞Ç‡∞°‡±ç ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç",
                query_mode_label: "‡∞Æ‡±ã‡∞°‡±ç‚Äå‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:",
                query_mode_general: "‡∞∏‡∞æ‡∞ß‡∞æ‡∞∞‡∞£ ‡∞µ‡∞ø‡∞∂‡±ç‡∞≤‡±á‡∞∑‡∞£",
                query_mode_code: "‡∞ï‡±ã‡∞°‡±ç ‡∞∏‡±ç‡∞®‡∞ø‡∞™‡±ç‡∞™‡±Ü‡∞ü‡±ç",
                query_text_placeholder: "‡∞Æ‡±Ä ‡∞Ü‡∞¶‡±á‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ: ‡∞ï‡±ç‡∞µ‡∞æ‡∞Ç‡∞ü‡∞Ç ‡∞ï‡∞Ç‡∞™‡±ç‡∞Ø‡±Ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‚Äå‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞≤‡±á‡∞¶‡∞æ ‡∞ï‡±ç‡∞µ‡∞ø‡∞ï‡±ç‚Äå‡∞∏‡∞æ‡∞∞‡±ç‡∞ü‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞™‡±à‡∞•‡∞æ‡∞®‡±ç ‡∞´‡∞Ç‡∞ï‡±ç‡∞∑‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞∞‡∞æ‡∞Ø‡∞Ç‡∞°‡∞ø)‡•§",
                query_image_label: "‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (‡∞Æ‡∞≤‡±ç‡∞ü‡±Ä‡∞Æ‡±ã‡∞°‡∞≤‡±ç ‡∞µ‡∞ø‡∞∂‡±ç‡∞≤‡±á‡∞∑‡∞£ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞ê‡∞ö‡±ç‡∞õ‡∞ø‡∞ï‡∞Ç):",
                query_submit: "‡∞Ü‡∞¶‡±á‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Ö‡∞Æ‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                query_waiting: "‡∞Ü‡∞¶‡±á‡∞∂‡∞Ç ‡∞Ö‡∞Æ‡∞≤‡±Å ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡±á‡∞ö‡∞ø ‡∞â‡∞Ç‡∞¶‡∞ø...",
                query_tts_read: "‡∞ó‡∞ü‡±ç‡∞ü‡∞ø‡∞ó‡∞æ ‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø üîä",
                query_citation_header: "‡∞ó‡±ç‡∞∞‡±å‡∞Ç‡∞°‡∞ø‡∞Ç‡∞ó‡±ç ‡∞Æ‡±Ç‡∞≤‡∞æ‡∞≤‡±Å:",
                settings_title: "‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞∏‡±Ü‡∞ü‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç‚Äå‡∞≤‡±Å",
                settings_source_code: "HTML ‡∞∏‡±ã‡∞∞‡±ç‡∞∏‡±ç ‡∞ï‡±ã‡∞°‡±ç ‡∞Ø‡±Å‡∞ü‡∞ø‡∞≤‡∞ø‡∞ü‡±Ä",
                settings_source_desc: "‡∞à ‡∞Ö‡∞™‡±ç‡∞≤‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞∏‡±ã‡∞∞‡±ç‡∞∏‡±ç ‡∞ï‡±ã‡∞°‡±ç‚Äå‡∞®‡±Å ‡∞Æ‡±Ä ‡∞ï‡±ç‡∞≤‡∞ø‡∞™‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç‚Äå‡∞ï‡±Å ‡∞ï‡∞æ‡∞™‡±Ä ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø‡•§",
                settings_copy_btn: "HTML ‡∞∏‡±ã‡∞∞‡±ç‡∞∏‡±ç‚Äå‡∞®‡±Å ‡∞ï‡±ç‡∞≤‡∞ø‡∞™‡±ç‚Äå‡∞¨‡±ã‡∞∞‡±ç‡∞°‡±ç‚Äå‡∞ï‡±Å ‡∞ï‡∞æ‡∞™‡±Ä ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                settings_download_btn: "‡∞µ‡±Ü‡∞¨‡±ç‚Äå‡∞∏‡±à‡∞ü‡±ç ‡∞´‡±à‡∞≤‡±ç‚Äå‡∞®‡±Å ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                settings_key_info: "API Key Information",
                settings_key_desc: "All AI functions are powered by the **Gemini API**. The key is handled securely by the canvas environment.",
                settings_close: "CLOSE INTERFACE"
            }
        };

        function switchLanguage(lang) {
            const data = languageData[lang] || languageData['en'];
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (data[key]) {
                    element.textContent = data[key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (data[key]) {
                    element.placeholder = data[key];
                }
            });
            // Update document title
            document.title = data.title;
        }

        // Initialize with English on load
        document.addEventListener('DOMContentLoaded', () => {
            switchLanguage('en');
        });

        // ----------------------------------------------------------------------------
        // 5. LLM Feature: IDEA MATRIX BRAINSTORM (View 2)
        // ----------------------------------------------------------------------------

        async function handleBrainstorm(event) {
            event.preventDefault();
            const inputElement = document.getElementById('brainstorm-input');
            const outputDiv = document.getElementById('brainstorm-output');
            const statusP = document.getElementById('brainstorm-status');
            const userQuery = inputElement.value;

            if (!userQuery) return;

            statusP.textContent = 'Executing Neural Injection... Standby...';
            outputDiv.innerHTML = '';

            // FIX: Append API_KEY in exponentialBackoffFetch
            const apiUrl = `${API_BASE_URL}/gemini-2.5-flash-preview-09-2025:generateContent`;
            const systemPrompt = `You are a creative idea generation matrix. Based on the user's topic, you must generate a list of exactly three highly creative, divergent, and unique concepts. The output must be a valid JSON array of objects, where each object has a key 'idea' with the concept description. Do not include any text outside the JSON block.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "idea": { "type": "STRING" }
                            },
                            propertyOrdering: ["idea"]
                        }
                    }
                }
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (jsonText) {
                    const ideas = JSON.parse(jsonText);
                    let html = '<ol class="list-decimal pl-5 space-y-4">';
                    ideas.forEach((item, index) => {
                        html += `<li class="text-lg text-white/90">${item.idea}</li>`;
                    });
                    html += '</ol>';
                    outputDiv.innerHTML = html;
                    statusP.textContent = 'Generation Complete. Concepts Deployed.';
                } else {
                    throw new Error("Invalid response structure or empty content.");
                }

            } catch (error) {
                console.error("Brainstorm API Error:", error);
                statusP.textContent = `[ERROR]: Neural Injection Failed. Check console for details. (${error.message})`;
                outputDiv.innerHTML = `<p class="text-red-500">Processing Error. System stability compromised.</p>`;
            }
        }

        // ----------------------------------------------------------------------------
        // 6. LLM Feature: CORE COMMAND CENTER (View 3)
        // ----------------------------------------------------------------------------

        let lastQueryText = ""; // Stores text for TTS

        async function handleCommandCenter(event) {
            event.preventDefault();
            const form = document.getElementById('query-form');
            const textInput = document.getElementById('query-input-text');
            const imageInput = document.getElementById('query-input-image');
            const mode = form.querySelector('input[name="query_mode"]:checked').value;
            const outputDiv = document.getElementById('query-output');
            const statusP = document.getElementById('query-status');
            const ttsControls = document.getElementById('tts-controls');

            const userQuery = textInput.value;
            const imageFile = imageInput.files[0];

            if (!userQuery && !imageFile) return;

            statusP.textContent = 'Executing Command... Standby...';
            outputDiv.innerHTML = '';
            ttsControls.classList.add('hidden');
            lastQueryText = "";

            // FIX: Append API_KEY in exponentialBackoffFetch
            const apiUrl = `${API_BASE_URL}/gemini-2.5-flash-preview-09-2025:generateContent`;
            let systemPrompt = "";
            let tools = undefined;

            if (mode === 'code') {
                systemPrompt = "You are a specialized code generation engine. When generating code, you MUST only output the code block using standard markdown syntax (e.g., ```python\n...\n```). Do not include any conversational text, explanations, or citations outside of the code block.";
            } else { // general/grounded search
                systemPrompt = "You are an advanced factual analysis engine. Provide a concise and accurate response to the user's query. If the query is a simple factual question, use Google Search for grounding.";
                if (!imageFile) {
                     tools = [{ "google_search": {} }]; // Use grounding only for text-only factual queries
                }
            }

            const contents = [];
            let parts = [{ text: userQuery }];

            if (imageFile) {
                try {
                    const base64Image = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result.split(',')[1]);
                        reader.onerror = reject;
                        reader.readAsDataURL(imageFile);
                    });
                    parts.push({
                        inlineData: {
                            mimeType: imageFile.type,
                            data: base64Image
                        }
                    });
                } catch (e) {
                    console.error("Image loading failed:", e);
                    statusP.textContent = 'Error: Could not process image file.';
                    return;
                }
            }

            contents.push({ role: "user", parts: parts });

            const payload = {
                contents: contents,
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: tools
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];
                const text = candidate?.content?.parts?.[0]?.text;

                if (text) {
                    outputDiv.innerHTML = markdownToHtml(text);
                    lastQueryText = text;

                    // Handle Grounding Sources (if used)
                    const groundingMetadata = candidate?.groundingMetadata;
                    let sources = [];
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    if (sources.length > 0) {
                        let sourceHtml = `<h4 class="text-lg font-bold mt-6 mb-2 text-neon-teal" data-i18n="query_citation_header">${languageData[document.getElementById('language-select').value].query_citation_header}</h4><ul class="list-disc pl-5 text-sm space-y-1 text-white/70">`;
                        sources.forEach(s => {
                            sourceHtml += `<li><a href="${s.uri}" target="_blank" class="hover:underline text-neon-teal/80">${s.title}</a></li>`;
                        });
                        sourceHtml += '</ul>';
                        outputDiv.innerHTML += sourceHtml;
                    }

                    statusP.textContent = 'Command Executed. Results Deployed.';
                    ttsControls.classList.remove('hidden');

                } else {
                    throw new Error("Invalid response structure or empty content.");
                }

            } catch (error) {
                console.error("Command Center API Error:", error);
                statusP.textContent = `[ERROR]: Neural Injection Failed. Check console for details. (${error.message})`;
                outputDiv.innerHTML = `<p class="text-red-500">Processing Error. System stability compromised.</p>`;
            }
        }

        // Simple markdown to HTML conversion for output styling
        function markdownToHtml(markdown) {
            // Replace **bold** with <strong>
            let html = markdown.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Replace *italic* with <em>
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            // Basic line breaks
            html = html.replace(/\n/g, '<br>');

            // Handle code blocks (simple approximation)
            html = html.replace(/```(\w+)?\n([\s\S]*?)\n```/g, (match, p1, p2) => {
                const language = p1 || 'plaintext';
                // Use <pre> and <code> for code display, applying Tailwind styling
                return `<pre class="bg-gray-900 p-4 rounded-md overflow-x-auto text-sm text-green-400 mt-4 mb-4"><code>${p2.trim()}</code></pre>`;
            });

            return html;
        }

        // ----------------------------------------------------------------------------
        // 7. LLM Feature: TEXT-TO-SPEECH (TTS)
        // ----------------------------------------------------------------------------

        async function handleTTS() {
            if (!lastQueryText) {
                console.error("No text available for TTS.");
                return;
            }

            const ttsButton = document.getElementById('tts-button');
            const audioPlayer = document.getElementById('tts-audio');
            const originalButtonText = ttsButton.querySelector('span').textContent;

            ttsButton.disabled = true;
            ttsButton.querySelector('span').textContent = 'Generating Audio...';
            audioPlayer.classList.add('hidden');
            audioPlayer.pause();
            audioPlayer.removeAttribute('src');

            // FIX: Append API_KEY in exponentialBackoffFetch
            const apiUrl = `${API_BASE_URL}/gemini-2.5-flash-preview-tts:generateContent`;
            const voice = "Kore"; // Choosing a firm, clear voice

            const payload = {
                contents: [{ parts: [{ text: lastQueryText }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: voice }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType; // Should be audio/L16;rate=24000

                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    const match = mimeType.match(/rate=(\d+)/);
                    const sampleRate = match ? parseInt(match[1], 10) : 24000;

                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);

                    audioPlayer.setAttribute('src', audioUrl);
                    audioPlayer.classList.remove('hidden');
                    audioPlayer.play();
                    ttsButton.querySelector('span').textContent = 'Playing...';

                    // Reset button after playing
                    audioPlayer.onended = () => {
                        ttsButton.disabled = false;
                        ttsButton.querySelector('span').textContent = originalButtonText;
                    };

                } else {
                    throw new Error("Invalid TTS response format or missing audio data.");
                }

            } catch (error) {
                console.error("TTS API Error:", error);
                ttsButton.querySelector('span').textContent = 'TTS Error!';
            } finally {
                // Ensure button resets if an error occurs before playback starts
                if (!audioPlayer.src) {
                    ttsButton.disabled = false;
                    ttsButton.querySelector('span').textContent = originalButtonText;
                }
            }
        }

        // ----------------------------------------------------------------------------
        // 8. SETTINGS UTILITIES
        // ----------------------------------------------------------------------------

        function copySourceCode() {
            const htmlSource = document.documentElement.outerHTML;
            const btnText = document.getElementById('copy-btn-text');

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(htmlSource)
                    .then(() => {
                        btnText.textContent = 'COPIED! CODE IN CLIPBOARD.';
                        setTimeout(() => switchLanguage(document.getElementById('language-select').value), 2000);
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                        // Fallback for environments where clipboard API is restricted
                        const tempTextArea = document.createElement('textarea');
                        tempTextArea.value = htmlSource;
                        document.body.appendChild(tempTextArea);
                        tempTextArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempTextArea);
                        btnText.textContent = 'COPIED! (Fallback Used)';
                        setTimeout(() => switchLanguage(document.getElementById('language-select').value), 2000);
                    });
            } else {
                btnText.textContent = 'Manual Copy Required: Navigator not supported.';
                console.warn('Clipboard API not available. Manual copy is required.');
            }
        }

        /**
         * Downloads the complete HTML source of the application as an index.html file.
         */
        function downloadSourceCode() {
            const htmlSource = document.documentElement.outerHTML;
            const filename = 'cyberspace_ai_hub.html';
            // Create a Blob containing the HTML source
            const blob = new Blob([htmlSource], { type: 'text/html' });
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element to trigger the download
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();

            // Clean up the temporary element and revoke the object URL
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

    </script>
</body>
</html>
